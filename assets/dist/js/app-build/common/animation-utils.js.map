{"version":3,"sources":["common/animation-utils.ts"],"names":[],"mappings":"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","file":"common/animation-utils.js","sourcesContent":["import {rafPolyfill} from './request-animation-frame'\nimport {runCallback} from './utils'\n\nrafPolyfill()\n\nlet transitionEventName;\n\nexport function getTransitionEndEventName() {\n    if (transitionEventName !== undefined) {\n        return transitionEventName\n    }\n\n    let detectedTransition;\n    const el = document.createElement('transitiondetector'),\n        transitions = {\n            'transition': 'transitionend',\n            // see also http://ianlunn.co.uk/articles/opera-12-otransitionend-bugs-and-workarounds/\n            'OTransition': 'oTransitionEnd',\n            'MozTransition': 'transitionend',\n            'webkitTransition': 'webkitTransitionEnd'\n        };\n\n    Object.keys(transitions).some(function (transition) {\n        if (el.style[transition] !== undefined) {\n            detectedTransition = transitions[transition]\n\n            return true\n        }\n\n        return false\n    })\n\n    if (!detectedTransition) {\n        detectedTransition = false\n    }\n\n    return (transitionEventName = detectedTransition)\n}\n\nlet transformStylePropertyName;\n\nexport function getTransformStyleProperty(append = ''): string {\n    if (transformStylePropertyName !== undefined) {\n        return transformStylePropertyName + append\n    }\n\n    let detectedTransform;\n    const el = document.createElement('transformdetector'),\n        transforms = [\n            'transform',\n            'OTransform',\n            'msTransform',\n            'MozTransform',\n            'webkitTransform'\n        ];\n\n    transforms.some && transforms.some(function (transform) {\n        if (el.style[transform] !== undefined) {\n            detectedTransform = transform\n\n            return true\n        }\n    })\n\n    if (!detectedTransform) {\n        detectedTransform = ''\n    }\n\n    return (transformStylePropertyName = detectedTransform) + append\n}\n\ninterface transitionStyleProperties {\n    [key: string]: string\n}\n\nlet transitionStyleProperties: transitionStyleProperties = {}\n\nexport function getTransitionStyleProperty(property?: string): string {\n    property = property || 'transition'\n\n    if (transitionStyleProperties[property] !== undefined) {\n        return transitionStyleProperties[property]\n    }\n\n    if (transitionStyleProperties.prefix === undefined) {\n        let transformStyleProperty = getTransformStyleProperty();\n\n        if (!transformStyleProperty) {\n            return transitionStyleProperties[property] = ''\n        }\n\n        transitionStyleProperties.prefix = transformStyleProperty.replace(/transform/i, '')\n    }\n\n    const prefix = transitionStyleProperties.prefix;\n\n    const propertyPrefixed = !prefix ? property : prefix + property.charAt(0).toUpperCase() + property.slice(1); // prefix + capitalized\n\n    return transitionStyleProperties[property] = propertyPrefixed\n}\n\nlet isTransformSupport3dSupported;\n\nexport function transformSupport3d() {\n    if (isTransformSupport3dSupported !== undefined) {\n        return isTransformSupport3dSupported\n    }\n\n    let transform = getTransformStyleProperty();\n\n    if (!transform) {\n        return (isTransformSupport3dSupported = false)\n    }\n\n    const el = document.createElement('transformdetector');\n    const defaultTransformData = el[transform];\n    el[transform] = 'translateZ(0)'\n\n    if (!el[transform] || el[transform] == defaultTransformData) {\n        return (isTransformSupport3dSupported = false)\n    }\n    else {\n        return (isTransformSupport3dSupported = true)\n    }\n}\n\nexport namespace fade {\n    const finishTransitionEvent = 'finishTransition'\n    const cancelTransitionEvent = 'cancelTransition'\n\n    const dataInitialOpacityAttr = 'data-initial-opacity'\n    const displayAsAttr = 'data-display-as'\n\n    export function toggle(el: HTMLElement, show: boolean, callback?, layoutChangedCallback?, displayAs: string = 'block') {\n        cancel(el)\n\n        let animationEndCallback,\n            removeListeners,\n            transitionEnd = getTransitionEndEventName();\n\n        animationEndCallback = function (e) {\n            if (e && e.type !== finishTransitionEvent && (e.target !== el || e.propertyName !== 'opacity')) {\n                return\n            }\n\n            removeListeners()\n\n            if (!show) {\n                el.style.display = 'none'\n                el.style.opacity = ''\n            }\n\n            runCallback(callback)\n        }\n\n        removeListeners = function () {\n            el.removeEventListener(transitionEnd, animationEndCallback)\n            el.removeEventListener(finishTransitionEvent, animationEndCallback)\n            el.removeEventListener(cancelTransitionEvent, removeListeners)\n        }\n\n        el.addEventListener(transitionEnd, animationEndCallback)\n        el.addEventListener(finishTransitionEvent, animationEndCallback)\n        el.addEventListener(cancelTransitionEvent, removeListeners)\n\n        let nextOpacity: number;\n\n        const elComputedStyle = getComputedStyle(el);\n\n        if (show) {\n            nextOpacity = el.hasAttribute(dataInitialOpacityAttr) ? parseFloat(el.getAttribute(dataInitialOpacityAttr)) : 1\n\n            if (elComputedStyle.display === 'none') {\n                el.style.opacity = String(0)\n                el.style.display = ''\n\n                if (getComputedStyle(el).display === 'none') {\n                    el.style.display = el.getAttribute(displayAsAttr) || displayAs\n                }\n            }\n            else {\n                if (parseFloat(el.style.opacity) === 0) {\n                    el.style.opacity = String(nextOpacity)\n                }\n\n                runCallback(layoutChangedCallback)\n\n                return animationEndCallback()\n            }\n        }\n        else if (!show) {\n            if (el.style.display === 'none' || parseFloat(elComputedStyle.opacity) === 0 || (!el.clientHeight && !el.clientWidth)) {\n                return animationEndCallback()\n            }\n\n            if (!el.hasAttribute(dataInitialOpacityAttr)) {\n                el.setAttribute(dataInitialOpacityAttr, elComputedStyle.opacity)\n            }\n\n            nextOpacity = 0\n        }\n\n        requestAnimationFrame(function () {\n            runCallback(layoutChangedCallback)\n            el.style.opacity = String(nextOpacity)\n        })\n\n        let transitionDuration = getComputedStyle(el)[getTransitionStyleProperty('transitionDuration')];\n\n        if (!transitionEnd || !transitionDuration || !parseFloat(transitionDuration)) {\n            animationEndCallback()\n        }\n    }\n\n    export function finish(node: HTMLElement, callback?: Function, layoutChangedCallback?: Function) {\n        if (node.clientWidth && node.clientHeight) {\n            return\n        }\n\n        const finishTransition = document.createEvent('Event');\n\n        finishTransition.initEvent(finishTransitionEvent, true, true)\n\n        node.dispatchEvent(finishTransition)\n\n        runCallback(layoutChangedCallback)\n        runCallback(callback)\n    }\n\n    export function cancel(node: HTMLElement) {\n        const finishTransition = document.createEvent('Event');\n\n        finishTransition.initEvent(cancelTransitionEvent, true, true)\n\n        node.dispatchEvent(finishTransition)\n    }\n}\n\nexport class RafAnimationQueue {\n    private context: any\n    private queue: Array<Function>\n    private queueInProgress: boolean\n\n    constructor(context?: any) {\n        this.context = context || undefined\n\n        this.clear()\n    }\n\n    add(callback: Function, context?: any) {\n        if (callback instanceof Function) {\n            this.queue.push(callback.bind(context || this.context))\n\n            this.runQueue()\n        }\n\n        return this\n    }\n\n    delay() {\n        this.queue.push(null)\n\n        this.runQueue()\n\n        return this\n    }\n\n    runQueue() {\n        if (this.queueInProgress) {\n            return\n        }\n\n        this.queueInProgress = true\n\n        requestAnimationFrame(this.queueLoop.bind(this))\n    }\n\n    queueLoop() {\n        const callback = this.queue.shift();\n\n        callback instanceof Function && callback()\n\n        if (!this.queue.length) {\n            this.queueInProgress = false\n        }\n        else {\n            requestAnimationFrame(this.queueLoop.bind(this))\n        }\n    }\n\n    clear() {\n        this.queue = []\n    }\n}"],"sourceRoot":"../../../../src/ts"}