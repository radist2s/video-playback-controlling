{"version":3,"sources":["common/social-share.ts"],"names":[],"mappings":"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","file":"common/social-share.js","sourcesContent":["import * as _ from 'lodash'\n\nconst ogAttrRegex = /%(og:[\\S]+)%/g;\n\ninterface ShareLinksOptions {\n    callbackAfter?: (link?: HTMLElement) => void\n    callbackBefore?: (link?: HTMLElement) => void\n    linkComponentFilter?: (link?: HTMLElement, ogProperty?: string) => void\n}\n\nconst methods = {\n    init: function (options: ShareLinksOptions) {\n        if (this.hasAttribute('social-attached')) {\n            return\n        }\n\n        this.setAttribute('social-attached', true)\n\n        const settings: ShareLinksOptions = {\n            callbackAfter: function ($this) {\n            },\n            callbackBefore: null,\n            linkComponentFilter: null\n        };\n\n        _.extend(settings, options)\n\n        return this.addEventListener('click', methods.onLinkClick.bind(this, settings))\n    },\n    onLinkClick: function (settings: ShareLinksOptions, e) {\n        let linkNode;\n        const rootNode = this;\n        let socialNetwork;\n\n        while (!socialNetwork) {\n            linkNode = linkNode ? linkNode.parentNode : e.target\n\n            if (!linkNode || rootNode === linkNode) {\n                return\n            }\n\n            socialNetwork = linkNode.getAttribute('data-network')\n        }\n\n        e.preventDefault()\n\n        if (!linkNode.getAttribute('query-data-replaced')) {\n            methods.replaceLinkData(linkNode, settings)\n            linkNode.getAttribute('query-data-replaced', true)\n        }\n\n        const width = 650,\n            height = 450,\n            left = Math.floor(screen.width / 2 - width / 2),\n            top = Math.floor(screen.height / 2 - height / 2);\n\n        const windowParams = 'height=' + height + ',width=' + width + ',left=' + left + ',top=' + top\n            + ',toolbar=no,menubar=no,scrollbars=no,resizable=no,location=no,directories=no,status=no';\n\n        const url = linkNode.href || decodeURI(linkNode.getAttribute('data-href')),\n            title = linkNode.title;\n\n        const popup = window.open(url, title, windowParams);\n\n        try {\n            popup.document.title = title\n        }\n        catch (e) {\n        }\n\n        settings.callbackAfter(linkNode)\n\n        window.ga && ga('send', 'event', 'SocialShareRequest', socialNetwork)\n    },\n\n    replaceLinkData: function (linkNode, settings: ShareLinksOptions) {\n        if (settings.callbackBefore instanceof Function) {\n            settings.callbackBefore(linkNode)\n        }\n\n        const query = linkNode.search || '';\n\n        const queryVars = {};\n\n        query.substr(1).split('&').forEach(function (item) {\n            const itemParts = item.split('=');\n            queryVars[itemParts[0]] = itemParts[1]\n        })\n\n        Object.keys(queryVars).forEach(function (attr) {\n            let val;\n\n            try {\n                val = decodeURIComponent(queryVars[attr])\n            }\n            catch (e) {\n                val = queryVars[attr]\n            }\n\n            if (ogAttrRegex.test(val)) {\n                val = val.replace(ogAttrRegex, function (match, ogProp) {\n                    if (settings.linkComponentFilter instanceof Function) {\n                        const linkComponent = settings.linkComponentFilter(linkNode, ogProp);\n\n                        if (linkComponent !== undefined && linkComponent !== null) {\n                            return linkComponent\n                        }\n                    }\n\n                    const meta = document.head.querySelector(`meta[property=\"${ogProp}\"]`);\n\n                    return meta ? meta.getAttribute('content') : ''\n                })\n            }\n\n            queryVars[attr] = encodeURIComponent(val)\n        })\n\n        linkNode.search = ''\n\n        let linkHref = linkNode.href.replace(/\\?$/, '');\n\n        linkHref += '?' + (function () {\n            const query = [];\n\n            for (let prop in queryVars) {\n                if (!queryVars.hasOwnProperty(prop)) {\n                    continue\n                }\n\n                const value = queryVars[prop];\n\n                query.push(encodeURIComponent(prop) + '=' + value)\n            }\n\n            return query.join('&')\n        })()\n\n        linkNode.href = linkHref\n\n        return linkHref\n    }\n};\n\nconst $ = window['jQuery'] || window['Zepto'];\n\nif ($) {\n    $.fn.socialShare = function (method) {\n        if (methods[method]) {\n            return methods[method].apply(this.get(0), Array.prototype.slice.call(arguments, 1));\n        }\n        else if (typeof method === 'object' || !method) {\n            return methods.init.apply(this.get(0), arguments);\n        }\n        else {\n            $.error('Method ' + method + ' does not exist on jQuery.dateMiniChartControl');\n        }\n    }\n}\n\nexport default function socialShare(rootElements: HTMLElement | HTMLElement[] | NodeList, options?: ShareLinksOptions) {\n    if (!rootElements || (rootElements instanceof Array && rootElements.length === 0)) {\n        return\n    }\n\n    if (rootElements instanceof HTMLElement) {\n        rootElements = [rootElements]\n    }\n\n    Array.prototype.forEach.call(rootElements, function (node: HTMLElement) {\n        methods.init.call(node, options)\n    })\n}"],"sourceRoot":"../../../../src/ts"}